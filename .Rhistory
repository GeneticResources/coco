gamma = gammas * exp(alpha) / ((1+exp(alpha))^2)
beta = daner_dat$se * exp(alpha) / ((1+exp(alpha))^2)
y = 2*(daner_dat$af) * (1 - daner_dat$af) * daner_dat$sum_n
x = 1/beta^2
summary(lm(y ~ x - 1))
0.227020
daner_dat$n = daner_dat$sum_n
colnames(daner_dat)[c(1,20,21)] = c("rsid","af","info")
daner_dat = daner_dat[order(daner_dat$BP.x),]
r =  r_inverse(daner_dat$b ,0.5,daner_dat$af)
r(daner_dat$b,phi = 0.5,daner_dat$af)
gammas = r[,2]
u = 0.5
alpha = log(u/(1-u))
gamma = gammas * exp(alpha) / ((1+exp(alpha))^2)
beta = daner_dat$se * exp(alpha) / ((1+exp(alpha))^2)
y = 2*(daner_dat$af) * (1 - daner_dat$af) * daner_dat$sum_n
x = 1/beta^2
summary(lm(y ~ x - 1))
r =  function(gamma,phi,theta){
r = gamma/(((phi*(1-phi)) + 0.5*(1-2*phi) * (1 - 2*theta) * gamma) - (0.084 + 0.9 * phi * (1-2 * phi) * theta * (1-theta)) /(phi*(1-phi))* gamma^2)
r
}
r(daner_dat$b,phi = 0.5,daner_dat$af)
gammas = r2[,2]
u = 0.5
alpha = log(u/(1-u))
gamma = gammas * exp(alpha) / ((1+exp(alpha))^2)
beta = daner_dat$se * exp(alpha) / ((1+exp(alpha))^2)
y = 2*(daner_dat$af) * (1 - daner_dat$af) * daner_dat$sum_n
x = 1/beta^2
summary(lm(y ~ x - 1))
r(gamma,phi = 0.5, theta = daner_dat$af)
daner_dat$b - r(gamma,phi = 0.5, theta = daner_dat$af)
plot(daner_dat$b - r(gamma,phi = 0.5, theta = daner_dat$af))
plot(daner_dat$b - r(gamma,phi = 0.5, theta = daner_dat$af))
plot(daner_dat$b - r(gamma,phi = 0.5, theta = daner_dat$af))
plot(daner_dat$b - r(gamma,phi = 0.5, theta = daner_dat$af))
gamma/(((phi*(1-phi))
gamma
gamma/((0.5*(1-0.5)))
install.packages("mprf")
install.packages("Rmprf")
library("Rmprf")
library("Rmprf")
options(digits=20)
r[,1]
(daner_dat$b - r(gamma,phi = 0.5, theta = daner_dat$af)
daner_dat$b - r(gamma,phi = 0.5, theta = daner_dat$af
daner_dat$b - r(gamma,phi = 0.5, theta = daner_dat$af)
daner_dat$b - r(gamma,phi = 0.5, theta = daner_dat$af)
cbind(daner_dat$b ,r(gamma,phi = 0.5, theta = daner_dat$af))
daner_dat$FRQ_A_35476/daner_dat$FRQ_U_46839
daner_dat$FRQ_A_35476/daner_dat$FRQ_U_46839
35476 /(46839 + 35476)
plot(daner_dat$b - r(gamma,phi = 0.5, theta = daner_dat$af))
y = 2*(daner_dat$af) * (1 - daner_dat$af) * daner_dat$sum_n
x = 1/beta^2
summary(lm(y ~ x - 1))
y = 2*(daner_dat$af) * (1 - daner_dat$af) * daner_dat$sum_n
x = 1/beta^2
summary(lm(y ~ x - 1))
35476 /(46839 + 35476)
u = 0.43097855797849721204
alpha = log(u/(1-u))
gamma = gammas * exp(alpha) / ((1+exp(alpha))^2)
linear_ses = daner_dat$se * exp(alpha) / ((1+exp(alpha))^2)
linear_ses
linear_ses
linear_ses
linear_ses = daner_dat$se * exp(alpha) / ((1+exp(alpha))^2)
y = 2*(daner_dat$af) * (1 - daner_dat$af) * daner_dat$sum_n
x = 1/beta^2
summary(lm(y ~ x - 1))
0.2270194698296115476
r2
r2 =  r_inverse(daner_dat$b ,0.5,daner_dat$af)
r(daner_dat$b,phi = 0.5,daner_dat$af)
gammas = r2[,2]
gammas
rs
r2
u = 0.43097855797849721204
alpha = log(u/(1-u))
gamma = gammas * exp(alpha) / ((1+exp(alpha))^2)
linear_ses = daner_dat$se * exp(alpha) / ((1+exp(alpha))^2)
gammas
gammas
y = 2*(daner_dat$af) * (1 - daner_dat$af) * daner_dat$sum_n
x = 1/beta^2
summary(lm(y ~ x - 1))
r2 =  r_inverse(daner_dat$b ,u,daner_dat$af)
r(daner_dat$b,phi =u,daner_dat$af)
gammas = r2[,2]
u = 0.43097855797849721204
alpha = log(u/(1-u))
gamma = gammas * exp(alpha) / ((1+exp(alpha))^2)
linear_ses = daner_dat$se * exp(alpha) / ((1+exp(alpha))^2)
y = 2*(daner_dat$af) * (1 - daner_dat$af) * daner_dat$sum_n
x = 1/beta^2
summary(lm(y ~ x - 1))
colnames(daner_dat)[c(1,20,21)] = c("rsid","af","info")
daner_dat = daner_dat[order(daner_dat$BP.x),]
r2 =  r_inverse(daner_dat$b ,u,daner_dat$af)
r(daner_dat$b,phi =u,daner_dat$af)
gammas = r2[,2]
nrow(daner_dat)
u = 0.43097855797849721204
r2 =  r_inverse(daner_dat$b ,u,daner_dat$af)
r(daner_dat$b,phi =u,daner_dat$af)
gammas = r2[,2]
alpha = log(u/(1-u))
gamma = gammas * exp(alpha) / ((1+exp(alpha))^2)
linear_ses = daner_dat$se * exp(alpha) / ((1+exp(alpha))^2)
y = 2*(daner_dat$af) * (1 - daner_dat$af) * daner_dat$sum_n
x = 1/beta^2
summary(lm(y ~ x - 1))
y = 2*(daner_dat$af) * (1 - daner_dat$af) * daner_dat$sum_n
x = 1/linear_ses^2
summary(lm(y ~ x - 1))
options(digits = 3)
summary(lm(y ~ x - 1))
var_y
numeric()
length(numeric())
source('~/Sinai/corrcond/R/corrcond.R')
source('~/Sinai/corrcond/R/corrcond.R')
res_preparation = prep_dataset_common(data_set = daner_dat,ld_matrix= ld_matrix,ld_noise=0)
colnames(daner_dat)[2]
colnames(daner_dat)[2] = "pos"
res_preparation = prep_dataset_common(data_set = daner_dat,ld_matrix= ld_matrix,ld_noise=0)
daner_dat$se
r2
r2
daner_dat$se
res_preparation = prep_dataset_common(data_set = daner_dat,ld_matrix= ld_matrix,ld_noise=0)
daner_dat$se
daner_dat$se
res_preparation = prep_dataset_common(data_set = daner_dat,ld_matrix= ld_matrix,ld_noise=0)
source('~/Sinai/corrcond/R/corrcond.R')
res_preparation = prep_dataset_common(data_set = daner_dat,ld_matrix= ld_matrix,ld_noise=0)
daner_dat$se
source('~/Sinai/corrcond/R/corrcond.R')
source('~/Sinai/corrcond/R/corrcond.R')
source('~/Sinai/corrcond/R/corrcond.R')
res_preparation = prep_dataset_common(data_set = daner_dat,ld_matrix= ld_matrix,ld_noise=0)
res_preparation = prep_dataset_common(data_set = daner_dat,ld_matrix= ld_matrix,ld_noise=0, var_y = 3.7288262)
source('~/Sinai/corrcond/R/corrcond.R')
source('~/Sinai/corrcond/R/corrcond.R')
res_preparation = prep_dataset_common(data_set = daner_dat,ld_matrix= ld_matrix,ld_noise=0, var_y = 3.7288262)
stepwise_results = stepwise_conditional_run(res_preparation = res_preparation,p_value_threshold = 1e-3,var_y = 3.7288262)
all_but_one_df = all_but_one(res_preparation=res_preparation,stepwise_results = stepwise_results ,var_y=3.7288262)
res_preparation = prep_dataset_common(data_set = daner_dat,ld_matrix= ld_matrix,ld_noise=0, var_y = 3.7288262)
res_preparation
res_preparation$data_set
res_preparation$data_set
res_preparation$data_set$rsid
res_preparation$data_set$neff
plot(res_preparation$data_set$neff,res_preparation$data_set$n)
res_preparation = prep_dataset_common(data_set = daner_dat,ld_matrix= ld_matrix,ld_noise=0, var_y = 3.7288262)
res_preparation$data_set
res_preparation = prep_dataset_common(data_set = daner_dat,ld_matrix= ld_matrix,ld_noise=0, var_y = 3.7288262)
stepwise_results = stepwise_conditional_run(res_preparation = res_preparation,p_value_threshold = 1e-3,var_y = 3.7288262)
source('~/Sinai/corrcond/R/corrcond.R')
res_preparation = prep_dataset_common(data_set = daner_dat,ld_matrix= ld_matrix,ld_noise=0, var_y = 3.7288262)
stepwise_results = stepwise_conditional_run(res_preparation = res_preparation,p_value_threshold = 1e-3,var_y = 3.7288262)
source('~/Sinai/corrcond/R/corrcond.R')
source('~/Sinai/corrcond/R/corrcond.R')
res_preparation = prep_dataset_common(data_set = daner_dat,ld_matrix= ld_matrix,ld_noise=0, var_y = 3.7288262)
stepwise_results = stepwise_conditional_run(res_preparation = res_preparation,p_value_threshold = 1e-3,var_y = 3.7288262)
res_preparation = prep_dataset_common(data_set = daner_dat,ld_matrix= ld_matrix,ld_noise=0, var_y = 3.7288262)
stepwise_results = stepwise_conditional_run(res_preparation = res_preparation,p_value_threshold = 1e-3,var_y = 3.7288262)
source('~/Sinai/corrcond/R/corrcond.R')
all_but_one_df = all_but_one(res_preparation=res_preparation,stepwise_results = stepwise_results ,var_y=3.7288262)
source('~/Sinai/corrcond/R/corrcond.R')
all_but_one_df = all_but_one(data_set =daner_dat, ld_matrix = ld_matrix, stepwise_results = stepwise_resultsd ,var_y=3.7288262)
all_but_one_df = all_but_one(res_preparation=res_preparation,stepwise_results = stepwise_results ,var_y=3.7288262)
stepwise_results = stepwise_conditional_run(res_preparation = res_preparation,p_value_threshold = 1e-3,var_y = 3.7288262)
all_but_one_df = all_but_one(res_preparation=res_preparation,stepwise_results = stepwise_results ,var_y=3.7288262)
source('~/.active-rstudio-document', echo=TRUE)
source('~/Sinai/corrcond/R/corrcond.R')
all_but_one_df = all_but_one(res_preparation=res_preparation,stepwise_results = stepwise_results ,var_y=3.7288262)
source('~/Sinai/corrcond/R/corrcond.R')
res_preparation = prep_dataset_common(data_set = daner_dat,ld_matrix= ld_matrix,ld_noise=0, var_y = 3.7288262)
stepwise_results = stepwise_conditional_run(res_preparation = res_preparation,p_value_threshold = 1e-3,var_y = 3.7288262)
all_but_one_df = all_but_one(res_preparation=res_preparation,stepwise_results = stepwise_results ,var_y=3.7288262)
source('~/Sinai/corrcond/R/corrcond.R')
source('~/Sinai/corrcond/R/corrcond.R')
source('~/Sinai/corrcond/R/corrcond.R')
source('~/Sinai/corrcond/R/corrcond.R')
source('~/Sinai/corrcond/R/corrcond.R')
source('~/Sinai/corrcond/R/corrcond.R')
source('~/Sinai/corrcond/R/corrcond.R')
source('~/Sinai/corrcond/R/corrcond.R')
stepwise_conditional_wrapper(daner_dat,ld_matrix)
source('~/.active-rstudio-document', echo=TRUE)
stepwise_conditional_wrapper(data_set = daner_dat,ld_matrix = ld_matrix)
stepwise_conditional_wrapper(data_set = daner_dat,ld_matrix = ld_matrix)
source('~/Sinai/corrcond/R/corrcond.R')
source('~/Sinai/corrcond/R/corrcond.R')
stepwise_results = stepwise_conditional_run(res_preparation = res_preparation,p_value_threshold = 1e-3,var_y = 3.7288262)
stepwise_conditional_wrapper(data_set = daner_dat,ld_matrix = ld_matrix)
wrap_function = stepwise_conditional_wrapper(data_set = daner_dat,ld_matrix = ld_matrix)
source('~/Sinai/corrcond/R/corrcond.R')
source('~/Sinai/corrcond/R/corrcond.R')
source("R/corrcond.R")
library(data.table)
ld_matrix = as.matrix(read.table("/Volumes/Elements/paintor_runs/final_regions/11_5:72375077-72506696.LD.EUR.old", header=F))
frequencies = read.table("/Volumes/Elements/paintor_runs/final_regions/11_5:72375077-72506696.EUR", header=F)
-0.009888/.0107
-0.009888/.0107
-0.009888/.0107
-0.009888/.00107
-0.002888/.0019
-0.002000/.0019
0.0099/.007
0.0099/.007
0.0099/.007
0.024/.003
0.009/.007
-0.014/.002
-0.014/.00262
source("R/corrcond.R")
library(data.table)
ld_matrix = as.matrix(read.table("/Volumes/Elements/paintor_runs/final_regions/7_4:10802922-10909478.LD.EAS.old", header=F))
frequencies = read.table("/Volumes/Elements/paintor_runs/final_regions/7_4:10802922-10909478", header=F)
kottgen_meta_analysis = fread("~/Dunedin/Tony/Metanalysis/input_smr.txt", header=T)
all_af = fread("/Volumes/Elements/ftp.1000genomes.ebi.ac.uk/vol1/ftp/release/20130502/all_af.txt", header=F)
freq_af = merge(frequencies,all_af,by.x=3,by.y=1)
colnames(freq_af) = c("rsid","chr","pos","Z","chr1","pos1","a1","a2","pop1","af")
freq_af$af = as.numeric(freq_af$af)
idxs_with_betas = which(freq_af$rsid %in% kottgen_meta_analysis$SNP)
#freq_af = merge(freq_af,kottgen_meta_analysis,by=1)
freq_af
freq_af$af
freq_af = merge(frequencies,all_af,by.x=3,by.y=1)
freq_af
freq_af$V7
colnames(freq_af) = c("rsid","chr","pos","Z","chr1","pos1","a1","a2","pop1","af")
freq_af
ncol(freqSaf)
ncol(freq_af)
length(c("rsid","chr","pos","Z","chr1","pos1","a1","a2","pop1","af"))
freq_af
freq_af
kottgen_meta_analysis$b
freq_af
head(freq_af)
head(kottgen_meta_analysis)
frequencies = read.table("/Volumes/Elements/paintor_runs/final_regions/7_4:10802922-10909478.EUR", header=F)
kottgen_meta_analysis = fread("~/Dunedin/Tony/Metanalysis/input_smr.txt", header=T)
all_af = fread("/Volumes/Elements/ftp.1000genomes.ebi.ac.uk/vol1/ftp/release/20130502/all_af.txt", header=F)
freq_af = merge(frequencies,all_af,by.x=3,by.y=1)
colnames(freq_af) = c("rsid","chr","pos","Z","chr1","pos1","a1","a2","pop1","af")
freq_af$af = as.numeric(freq_af$af)
idxs_with_betas = which(freq_af$rsid %in% kottgen_meta_analysis$SNP)
#freq_af = merge(freq_af,kottgen_meta_analysis,by=1)
ld_matrix= ld_matrix[idxs_with_betas,idxs_with_betas]
freq_af = freq_af[idxs_with_betas,]
freq_af = merge(freq_af,kottgen_meta_analysis,by=1)
freq_af = freq_af[order(freq_af$pos),]
nrow(freq_af)
dim(ld_matrix)
nrow(frequencies)
ld_matrix = as.matrix(read.table("/Volumes/Elements/paintor_runs/final_regions/7_4:10802922-10909478.LD.EAS.old", header=F))
ld_matrix = as.matrix(read.table("/Volumes/Elements/paintor_runs/final_regions/7_4:10802922-10909478.LD.EUR.old", header=F))
idxs_with_betas = which(freq_af$rsid %in% kottgen_meta_analysis$SNP)
#freq_af = merge(freq_af,kottgen_meta_analysis,by=1)
ld_matrix= ld_matrix[idxs_with_betas,idxs_with_betas]
freq_af = freq_af[idxs_with_betas,]
freq_af = merge(freq_af,kottgen_meta_analysis,by=1)
freq_af = freq_af[order(freq_af$pos),]
dim(ld_matrix)
nrow(freq_af)
stepwise_conditional_wrapper(data_set = freq_af, ld_matrix=ld_matrix,p_value_threshold = 1e-3,var_y = 1.6421, ld_noise=0.1)
freq_af = merge(frequencies,all_af,by.x=3,by.y=1)
freq_af$af = as.numeric(freq_af$af)
idxs_with_betas = which(freq_af$rsid %in% kottgen_meta_analysis$SNP)
#freq_af = merge(freq_af,kottgen_meta_analysis,by=1)
ld_matrix= ld_matrix[idxs_with_betas,idxs_with_betas]
freq_af = freq_af[idxs_with_betas,]
freq_af = merge(freq_af,kottgen_meta_analysis,by=1)
freq_af = freq_af[order(freq_af$pos),]
freq_af = merge(frequencies,all_af,by.x=3,by.y=1)
colnames(freq_af) = c("rsid","chr","pos","Z","chr1","pos1","a1","a2","pop1","af")
freq_af$af = as.numeric(freq_af$af)
idxs_with_betas = which(freq_af$rsid %in% kottgen_meta_analysis$SNP)
#freq_af = merge(freq_af,kottgen_meta_analysis,by=1)
ld_matrix= ld_matrix[idxs_with_betas,idxs_with_betas]
freq_af = freq_af[idxs_with_betas,]
freq_af = merge(freq_af,kottgen_meta_analysis,by=1)
freq_af = freq_af[order(freq_af$pos),]
ld_matrix = as.matrix(read.table("/Volumes/Elements/paintor_runs/final_regions/7_4:10802922-10909478.LD.EUR.old", header=F))
ld_matrix= ld_matrix[idxs_with_betas,idxs_with_betas]
stepwise_conditional_wrapper(data_set = freq_af, ld_matrix=ld_matrix,p_value_threshold = 1e-3,var_y = 1.6421, ld_noise=0.1)
source("R/corrcond.R")
stepwise_conditional_wrapper(data_set = freq_af, ld_matrix=ld_matrix,p_value_threshold = 1e-3,var_y = 1.6421, ld_noise=0.1)
source("R/corrcond.R")
t
stepwise_conditional_wrapper(data_set = freq_af, ld_matrix=ld_matrix,p_value_threshold = 1e-3,var_y = 1.6421, ld_noise=0.1)
freq_af$Z
freq_af[order(abs(freq_af$Z)),]
freq_af[order(abs(freq_af$Z),decreasing = T),]
head(freq_af[order(abs(freq_af$Z),decreasing = T),])
source("R/corrcond.R")
library(data.table)
ld_matrix = as.matrix(read.table("/Volumes/Elements/paintor_runs/final_regions/9_4:88710413-89316460.LD.EUR.old", header=F))
ld_matrix = as.matrix(read.table("/Volumes/Elements/paintor_runs/final_regions/9_4:88710413-89316460.LD.EUR.old", header=F))
frequencies = read.table("/Volumes/Elements/paintor_runs/final_regions/9_4:88710413-89316460.EUR", header=F)
freq_af = merge(frequencies,all_af,by.x=3,by.y=1)
colnames(freq_af) = c("rsid","chr","pos","Z","chr1","pos1","a1","a2","pop1","af")
freq_af$af = as.numeric(freq_af$af)
idxs_with_betas = which(freq_af$rsid %in% kottgen_meta_analysis$SNP)
#freq_af = merge(freq_af,kottgen_meta_analysis,by=1)
ld_matrix= ld_matrix[idxs_with_betas,idxs_with_betas]
freq_af = freq_af[idxs_with_betas,]
freq_af = merge(freq_af,kottgen_meta_analysis,by=1)
freq_af = freq_af[order(freq_af$pos),]
stepwise_conditional_wrapper(data_set = freq_af, ld_matrix=ld_matrix,p_value_threshold = 1e-3,var_y = 1.6421, ld_noise=0.1)
freq_af = read.table("data/snp_summary.txt", header=T)
ld_matrix = as.matrix(read.table("data/ld_matrix_test.txt", header=F))
stepwise_results = stepwise_conditional_run(data_set = freq_af, ld_matrix=ld_matrix,p_value_threshold = 1e-4,var_y = 1.6421)
res_preparation = prep_dataset_common(data_set = freq_af,ld_matrix= ld_matrix,ld_noise=0.1)
stepwise_conditional_wrapper(data_set = freq_af, ld_matrix=ld_matrix,p_value_threshold = 1e-3,var_y = 1.6421, ld_noise=0.1)
stepwise_conditional_wrapper(data_set = freq_af, ld_matrix=ld_matrix,p_value_threshold = 1e-3,var_y = 1.6421, ld_noise=0.1)
freq_af$rsid == "rs2231142"
which(freq_af$rsid == "rs2231142")
freq_af = merge(frequencies,all_af,by.x=3,by.y=1)
idxs_with_betas = which(freq_af$rsid %in% kottgen_meta_analysis$SNP)
#freq_af = merge(freq_af,kottgen_meta_analysis,by=1)
ld_matrix= ld_matrix[idxs_with_betas,idxs_with_betas]
freq_af = freq_af[idxs_with_betas,]
freq_af = merge(freq_af,kottgen_meta_analysis,by=1)
freq_af = freq_af[order(freq_af$pos),]
freq_af = merge(frequencies,all_af,by.x=3,by.y=1)
colnames(freq_af) = c("rsid","chr","pos","Z","chr1","pos1","a1","a2","pop1","af")
freq_af$af = as.numeric(freq_af$af)
idxs_with_betas = which(freq_af$rsid %in% kottgen_meta_analysis$SNP)
#freq_af = merge(freq_af,kottgen_meta_analysis,by=1)
ld_matrix= ld_matrix[idxs_with_betas,idxs_with_betas]
freq_af = freq_af[idxs_with_betas,]
freq_af = merge(freq_af,kottgen_meta_analysis,by=1)
freq_af = freq_af[order(freq_af$pos),]
ld_matrix = as.matrix(read.table("/Volumes/Elements/paintor_runs/final_regions/9_4:88710413-89316460.LD.EUR.old", header=F))
ld_matrix= ld_matrix[idxs_with_betas,idxs_with_betas]
stepwise_conditional_wrapper(data_set = freq_af, ld_matrix=ld_matrix,p_value_threshold = 1e-3,var_y = 1.6421, ld_noise=0.1)
source("R/corrcond.R")
stepwise_conditional_wrapper(data_set = freq_af, ld_matrix=ld_matrix,p_value_threshold = 1e-3,var_y = 1.6421, ld_noise=0.1)
source("R/corrcond.R")
stepwise_conditional_wrapper(data_set = freq_af, ld_matrix=ld_matrix,p_value_threshold = 1e-3,var_y = 1.6421, ld_noise=0.1)
source("R/corrcond.R")
stepwise_conditional_wrapper(data_set = freq_af, ld_matrix=ld_matrix,p_value_threshold = 1e-3,var_y = 1.6421, ld_noise=0.1)
source("R/corrcond.R")
stepwise_conditional_wrapper(data_set = freq_af, ld_matrix=ld_matrix,p_value_threshold = 1e-3,var_y = 1.6421, ld_noise=0.1)
source("R/corrcond.R")
stepwise_conditional_wrapper(data_set = freq_af, ld_matrix=ld_matrix,p_value_threshold = 1e-3,var_y = 1.6421, ld_noise=0.1)
a = stepwise_conditional_wrapper(data_set = freq_af, ld_matrix=ld_matrix,p_value_threshold = 1e-3,var_y = 1.6421, ld_noise=0.1)
a = stepwise_conditional_wrapper(data_set = freq_af, ld_matrix=ld_matrix,p_value_threshold = 1e-3,var_y = 1.6421, ld_noise=0.1)
source("R/corrcond.R")
a = stepwise_conditional_wrapper(data_set = freq_af, ld_matrix=ld_matrix,p_value_threshold = 1e-3,var_y = 1.6421, ld_noise=0.1)
source("R/corrcond.R")
a = stepwise_conditional_wrapper(data_set = freq_af, ld_matrix=ld_matrix,p_value_threshold = 1e-3,var_y = 1.6421, ld_noise=0.1)
source("R/corrcond.R")
a = stepwise_conditional_wrapper(data_set = freq_af, ld_matrix=ld_matrix,p_value_threshold = 1e-3,var_y = 1.6421, ld_noise=0.1)
res_preparation = prep_dataset_common(data_set = freq_af,ld_matrix= ld_matrix,ld_noise=0.5)
a = stepwise_conditional_wrapper(data_set = freq_af, ld_matrix=ld_matrix,p_value_threshold = 1e-3,var_y = 1.6421, ld_noise=0.5)
a = stepwise_conditional_wrapper(data_set = freq_af, ld_matrix=ld_matrix,p_value_threshold = 9.186111e-06,var_y = 1.6421, ld_noise=0.1)
a
lappy(a,function(x) x$main_hit)
lapply(a,function(x) x$main_hit)
unlist(lapply(a,function(x) x$main_hit))
freq_af
freq_af$pos
order(freq_af$pos)
freq_af$rsid
order(freq_af$pos)
source("R/corrcond.R")
a = stepwise_conditional_wrapper(data_set = freq_af, ld_matrix=ld_matrix,p_value_threshold = 9.186111e-06,var_y = 1.6421, ld_noise=0.1)
source('~/Sinai/corrcond/R/corrcond.R')
a = stepwise_conditional_wrapper(data_set = freq_af, ld_matrix=ld_matrix,p_value_threshold = 9.186111e-06,var_y = 1.6421, ld_noise=0.1)
a = stepwise_conditional_wrapper(data_set = freq_af, ld_matrix=ld_matrix,p_value_threshold =1e-10,var_y = 1.6421, ld_noise=0.1)
a = stepwise_conditional_wrapper(data_set = freq_af, ld_matrix=ld_matrix,p_value_threshold =1e-10,var_y = 1.6421, ld_noise=0.1)
a = stepwise_conditional_wrapper(data_set = freq_af, ld_matrix=ld_matrix,p_value_threshold =1e-10,var_y = 1.6421, ld_noise=0.1)
a = stepwise_conditional_wrapper(data_set = freq_af, ld_matrix=ld_matrix,p_value_threshold =1e-10,var_y = 1.6421, ld_noise=0.1)
a$
freq_af == "rs2622629"
which(freq_af == "rs2622629")
which(freq_af$rsid == "rs2622629")
source('~/Sinai/corrcond/R/corrcond.R')
a = stepwise_conditional_wrapper(data_set = freq_af, ld_matrix=ld_matrix,p_value_threshold =1e-10,var_y = 1.6421, ld_noise=0.1)
source('~/Sinai/corrcond/R/corrcond.R')
a = stepwise_conditional_wrapper(data_set = freq_af, ld_matrix=ld_matrix,p_value_threshold =1e-10,var_y = 1.6421, ld_noise=0.1)
source('~/Sinai/corrcond/R/corrcond.R')
source('~/Sinai/corrcond/R/corrcond.R')
a = stepwise_conditional_wrapper(data_set = freq_af, ld_matrix=ld_matrix,p_value_threshold =1e-10,var_y = 1.6421, ld_noise=0.1)
ld_matrix[1272,]
ld_matrix[1272,1698]
ld_matrix[1272,1298]
which(freq_af == "rs2622629")
ld_matrix[1272,1298]
sqrt(0.5289)
a
plot(a[[1]])
plot(abs(a[[1]]$res_step$z_new),a[[1]]$res_step$pos)
plot(abs(a[[1]]$res_step$z_new) ~ a[[1]]$res_step$pos)
plot(abs(a[[2]]$res_step$z_new) ~ a[[2]]$res_step$pos)
plot(abs(a[[1]]$res_step$z_new) ~ a[[1]]$res_step$pos)
plot(abs(a[[1]]$res_step$z_new) ~ a[[1]]$res_step$pos)
plot(abs(a[[2]]$res_step$z_new) ~ a[[2]]$res_step$pos)
plot(abs(a[[3]]$res_step$z_new) ~ a[[3]]$res_step$pos)
plot(abs(a[[1]]$res_step$z_old) ~ a[[1]]$res_step$pos)
plot(abs(a[[1]]$res_step$z_old) ~ a[[1]]$res_step$pos)
par(mfrow=c(2,2))
plot(abs(a[[1]]$res_step$z_old) ~ a[[1]]$res_step$pos)
plot(abs(a[[3]]$res_step$z_new) ~ a[[3]]$res_step$pos)
plot(abs(a[[1]]$res_step$z_old) ~ a[[1]]$res_step$pos)
plot(abs(a[[3]]$res_step$z_new) ~ a[[3]]$res_step$pos)
plot(abs(a[[1]]$res_step$z_old) ~ a[[1]]$res_step$pos, ylim=c(0,30))
plot(abs(a[[3]]$res_step$z_new) ~ a[[3]]$res_step$pos,ylim=c(0,30) )
plot(abs(a[[2]]$res_step$z_old) ~ a[[2]]$res_step$pos)
plot(abs(a[[1]]$res_step$z_old) ~ a[[1]]$res_step$pos)
plot(abs(a[[1]]$res_step$z_old) ~ a[[1]]$res_step$pos, ylim=c(0,30))
plot(abs(a[[1]]$res_step$z_new) ~ a[[1]]$res_step$pos,ylim=c(0,30) )
plot(abs(a[[2]]$res_step$z_new) ~ a[[2]]$res_step$pos,ylim=c(0,30) )
plot(abs(a[[3]]$res_step$z_new) ~ a[[3]]$res_step$pos,ylim=c(0,30) )
plot(abs(a[[4]]$res_step$z_new) ~ a[[4]]$res_step$pos,ylim=c(0,30) )
a[[1]]$main_hit
unlist(lapply(a,function(x) x$main_hit))
a[[2]]$res_step
a[[2]]$res_step$p_old
a[[2]]$res_step$p_n'p_new'
a[[2]]$res_step$p_new
-log10(a[[2]]$res_step$p_new)
plot(-log10(a[[2]]$res_step$p_new))
plot(-log10(a[[2]]$res_step$p_new))
plot(-log10(a[[2]]$res_step$p_new))
plot(-log10(a[[2]]$res_step$z_new))
plot(abs(a[[2]]$res_step$z_new))
plot(abs(a[[2]]$res_step$z_old))
plot(abs(a[[2]]$res_step$z_new))
plot(abs(a[[2]]$res_step$z_old))
plot(abs(a[[2]]$res_step$z_new))
plot(abs(a[[2]]$res_step$z_old))
a[[2]]$res_step$p_n'p_new'
a
which(freq_af$rsid %in% c("rs2231142","rs2725212","rs3114020"))
ld_matrix[which(freq_af$rsid %in% c("rs2231142","rs2725212","rs3114020")),]
ld_matrix[which(freq_af$rsid %in% c("rs2231142","rs2725212","rs3114020")),which(freq_af$rsid %in% c("rs2231142","rs2725212","rs3114020"))]
a = stepwise_conditional_wrapper(data_set = freq_af, ld_matrix=ld_matrix,p_value_threshold =1e-10,var_y = 1.6421, ld_noise=0)
plot(abs(a[[2]]$res_step$z_old))
plot(abs(a[[2]]$res_step$z_new))
a[[2]]$res_step[1189,]
ld_matrix = as.matrix(read.table("/Volumes/Elements/paintor_runs/final_regions/13_6:25391851-26189933.LD.EUR.old", header=F))
frequencies = read.table("/Volumes/Elements/paintor_runs/final_regions/13_6:25391851-26189933.EUR", header=F)
freq_af = merge(frequencies,all_af,by.x=3,by.y=1)
colnames(freq_af) = c("rsid","chr","pos","Z","chr1","pos1","a1","a2","pop1","af")
freq_af$af = as.numeric(freq_af$af)
idxs_with_betas = which(freq_af$rsid %in% kottgen_meta_analysis$SNP)
#freq_af = merge(freq_af,kottgen_meta_analysis,by=1)
ld_matrix= ld_matrix[idxs_with_betas,idxs_with_betas]
freq_af = freq_af[idxs_with_betas,]
freq_af = merge(freq_af,kottgen_meta_analysis,by=1)
freq_af = freq_af[order(freq_af$pos),]
a = stepwise_conditional_wrapper(data_set = freq_af, ld_matrix=ld_matrix,p_value_threshold =1e-10,var_y = 1.6421, ld_noise=0)
a = stepwise_conditional_wrapper(data_set = freq_af, ld_matrix=ld_matrix,p_value_threshold =1e-5,var_y = 1.6421, ld_noise=0)
a[[2]]$main_hit
a[[2]]$conditional_on
a[[2]]$main_hit
a[[2]]$conditional_on
a[[2]]$main_hit
nrow(a)
length(a)
a[[2]]$main_hit
a[[2]]$main_hit
a = stepwise_conditional_wrapper(data_set = freq_af, ld_matrix=ld_matrix,p_value_threshold =1e-5,var_y = 1.6421, ld_noise=0)
a = stepwise_conditional_wrapper(data_set = freq_af, ld_matrix=ld_matrix,p_value_threshold =1e-5,var_y = 1.6421, ld_noise=0.1)
freq_af$rsid == "rs186137462"
which(freq_af$rsid == "rs186137462")
freq_af[1945,]
res_preparation = prep_dataset_common(data_set = freq_af,ld_matrix= ld_matrix,ld_noise=0, var_y = 1.6421)
res_preparation
conditional_from_ids(rsids = c("rs71557308,rs186137462,rs116399700,rs1359231,rs1165178"))
conditional_from_ids(res_preparation = res_preparation,rsids = c("rs71557308,rs186137462,rs116399700,rs1359231,rs1165178"))
res_preparation$data_set$rsid
conditional_from_ids(res_preparation = res_preparation,rsids = c("rs71557308","rs186137462","rs116399700","rs1359231","rs1165178"))
df = conditional_from_ids(res_preparation = res_preparation,rsids = c("rs71557308","rs186137462","rs116399700","rs1359231","rs1165178"))
df$main_hit
df$res_step
df$res_step$p_new
df$res_step$rsid %in% c("rs71557308","rs186137462","rs116399700","rs1359231","rs1165178")
which(df$res_step$rsid %in% c("rs71557308","rs186137462","rs116399700","rs1359231","rs1165178"))
df[(df$res_step$rsid %in% c("rs71557308","rs186137462","rs116399700","rs1359231","rs1165178")),]
df[(df$res_step$rsid %in% c("rs71557308","rs186137462","rs116399700","rs1359231","rs1165178"),]
df[(df$res_step$rsid %in% c("rs71557308","rs186137462","rs116399700","rs1359231","rs1165178"))]
df[(df$res_step$rsid %in% c("rs71557308","rs186137462","rs116399700","rs1359231","rs1165178"))]
df$res_step[(df$res_step$rsid %in% c("rs71557308","rs186137462","rs116399700","rs1359231","rs1165178"))]
df$res_step[(df$res_step$rsid %in% c("rs71557308","rs186137462","rs116399700","rs1359231","rs1165178")),]
source('~/Sinai/corrcond/R/corrcond.R')
df = conditional_from_ids(res_preparation = res_preparation,rsids = c("rs71557308","rs186137462","rs116399700","rs1359231","rs1165178"))
df$res_step[(df$res_step$rsid %in% c("rs71557308","rs186137462","rs116399700","rs1359231","rs1165178"))]
df$res_step[(df$res_step$rsid %in% c("rs71557308","rs186137462","rs116399700","rs1359231","rs1165178")),]
source('~/Sinai/corrcond/R/corrcond.R')
df = conditional_from_ids(res_preparation = res_preparation,rsids = c("rs71557308","rs186137462","rs116399700","rs1359231","rs1165178"))
df$res_step[(df$res_step$rsid %in% c("rs71557308","rs186137462","rs116399700","rs1359231","rs1165178")),]
snpdat = read.table("data/chr2_200825237_I_2merged_2_200628237_201293237.ld.snpdat", header=T)
snpdat = read.table("data/chr2_200825237_I_2merged_2_200628237_201293237.ld.snpdat", header=T)
res_preparation = prep_dataset_common(data_set = snpdat,ld_matrix= ld_matrix,ld_noise=0, var_y = 3.7288262)
snpdat
snpdat$Z
snpdat$p
snpdat$P
snpdat$Z
